# Cell-cell communication


## Input

The `runCellChat()` function requires a `SingleCellExperiment` object that includes cell clustering information. For details, refer to the [Clustering](https://yulab-smu.top/sclet/seurat-like-functions.html#clustering) session.

The `group` parameter should reference a variable within the `SingleCellExperiment` object that holds the clustering data.

Users can add their own clustering using the following commands:

```
colData(sce)$group_name <- group
# OR
sce[["group_name"]] <- group
```


## CellChat

Wrapper function for CellChat.

See also <https://htmlpreview.github.io/?https://github.com/jinworks/CellChat/blob/master/tutorial/CellChat-vignette.html#c-starting-from-a-singlecellexperiment-object>

```{r}
library(sclet)
library(aplot)

# use demo data from CellChat, hmskin_sce
sce <- qs::qread("data/hmskin_sce.qs")
cci_obj <- runCellChat(sce, group = "labels")
```

## visulization
```{r cci-1, fig.width=15, fig.height=8}
groupSize <- as.numeric(table(cci_obj@idents))
plot_list(
    ~CellChat::netVisual_circle(cci_obj@net$count, 
        vertex.weight = groupSize, weight.scale = T, 
        label.edge= F, title.name = "Number of interactions"),
    ~CellChat::netVisual_circle(cci_obj@net$weight, 
        vertex.weight = groupSize, weight.scale = T, 
        label.edge= F, title.name = "Interaction weights/strength")
)
```


```{r cci-2, fig.width=7.5, fig.height=8}
pathways.show <- c("CXCL") 
vertex.receiver = seq(1,4) 
# CellChat::netVisual_aggregate(cci_obj, signaling = pathways.show,  vertex.receiver = vertex.receiver)
CellChat::netVisual_aggregate(cci_obj, signaling = pathways.show, layout = "circle")
```


```{r cci-3, fig.width=7.5, fig.height=8}
CellChat::netVisual_aggregate(cci_obj, signaling = pathways.show, layout = "chord")
```


```{r cci-4, fig.width=6, fig.height=6}
CellChat::netVisual_heatmap(cci_obj, signaling = pathways.show, color.heatmap = "Reds")
```

```{r cci-5, fig.width=6, fig.height=6}
group.cellType <- c(rep("FIB", 4), rep("DC", 4), rep("TC", 4)) # grouping cell clusters into fibroblast, DC and TC cells
names(group.cellType) <- levels(cci_obj@idents)
CellChat::netVisual_chord_cell(cci_obj, signaling = pathways.show, group = group.cellType, title.name = paste0(pathways.show, " signaling network"))
```


```{r cci-6, fig.width=6, fig.height=6}
CellChat::netAnalysis_contribution(cci_obj, signaling = pathways.show)
```


```{r cci-7, fig.width=6, fig.height=6}
pairLR.CXCL <- CellChat::extractEnrichedLR(cci_obj, signaling = pathways.show, geneLR.return = FALSE)
LR.show <- pairLR.CXCL[1,] 
vertex.receiver = seq(1,4)
# CellChat::netVisual_individual(cci_obj, signaling = pathways.show,  pairLR.use = LR.show, vertex.receiver = vertex.receiver)
CellChat::netVisual_individual(cci_obj, signaling = pathways.show, pairLR.use = LR.show, layout = "circle")
```


```{r cci-8, fig.width=6, fig.height=6}
CellChat::netVisual_individual(cci_obj, signaling = pathways.show, pairLR.use = LR.show, layout = "chord")
```

```{r cci-9, fig.width=5, fig.height=6}
CellChat::netVisual_bubble(cci_obj, sources.use = 4, targets.use = c(5:11), remove.isolate = FALSE)
```


